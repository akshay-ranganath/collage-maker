<!DOCTYPE html>
<html lang="en">
   <head>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, minimum-scale=1"/>
      <link rel="stylesheet" href="style.css">
      <link href="https://fonts.googleapis.com/css2?family=PT+Sans&display=swap" rel="stylesheet">
      <script type="text/javascript" src="script.js"></script>
      <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>      
   </head>
   <body>
      <h1>Collage Creator</h1>
      <hr />
      <div>
         <h2>Step 1: Choose a Background</h2>
         <!-- div to show the background images available -->
         <div id="bgpics"></div>
      </div>
      <div>
         <h2>Step 2: Upload your files</h2>
         <button id="upload_widget" class="cloudinary-button">Upload files</button>
         <!-- div to show the thumbnails of the uploaded images -->
         <div id='images'>  </div>
      </div>
      <div>
         <h2>Step 3: Add a message (optional)</h2>
         <br />
         <input type="text" id="message"></input>
      </div>
      <div>
         <h2>Step 4: Create Collage</h2>
         <button id="collage" class="cloudinary-button">Create Collage</button>
         <button id="reset" class="cloudinary-button">Reset</button>
      </div>
      <!-- placeholder for the final collage -->
      <div id="finalCollage"></div>
      
      <script type="text/javascript">
      /* ------------------ USER SPECIFIC SETUP --------------------------- */
      // Add your cloudname and preset here

      // cloud name
      var cloudName = 'mermaid'
      // upload preset name
      var preset = 'unsignedCollageUpload'

      /* ------------------ USER SPECIFIC ENDS --------------------------- */

      // an array to host the list of images uploaded
      var images = new Array();              

      // variable holding the name of the background image that is selected for generating the collage
      var selectedBackground = findSelectedBackground(); 
         
         /* 
          Attach an even handler to the button that creates a collage.
          The function then takes over and does the computation and generates an image collage.
          */

         document.getElementById("collage").addEventListener(
           "click",
           function() {
             generateCollage(images, selectedBackground);      
           },
           false
         );
         
         /*
         Reset the selections so that a user can try a new collage.
         */
         document.getElementById("reset").addEventListener(
           "click",
           function() {
             // clear all selections
             document.getElementById('images').innerHTML = ""
             document.getElementById('finalCollage').innerHTML = ""
             document.getElementById('message').value=""
             var bgpics = document.getElementById('bgpics').childNodes
                 for(var i=0;i<bgpics.length;i++){
                   bgpics[i].style = ""
                 }
             images = new Array();
           },
           false
         );
         
        /*
        Initialize the uploader widget and attach a click event.
        */          
         var myWidget = cloudinary.createUploadWidget({
             cloudName: window.cloudName,
             uploadPreset: window.preset
           },
           (error, result) => {
             if (!error && result && result.event === "success") {
               images.push(result.info.public_id);
               displayUploadedImage(result.info.public_id)
             }
           }
         );
         document.getElementById("upload_widget").addEventListener(
           "click",
           function() {
             myWidget.open();
           },
           false
         );             
      </script>
   </body>
</html>